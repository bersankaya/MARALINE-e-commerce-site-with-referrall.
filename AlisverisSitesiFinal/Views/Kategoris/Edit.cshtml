@model AlisverisSitesiFinal.Models.Kategori

@{
    ViewData["Title"] = "Kategori Düzenle";
}

<h2>Kategori Düzenle</h2>

<form asp-action="Edit" method="post" enctype="multipart/form-data">
    @* Anti-forgery token otomatik eklenir form tag helper ile *@
    <input type="hidden" asp-for="Id" />

    <div class="form-group mb-3">
        <label asp-for="Ad" class="form-label">Kategori Adı</label>
        <input asp-for="Ad" class="form-control" />
        <span asp-validation-for="Ad" class="text-danger"></span>
    </div>

    <div class="form-group mb-3">
        <label class="form-label">Mevcut Görsel</label>
        <div>
            @if (!string.IsNullOrEmpty(Model.ImageUrl))
            {
                <img src="@(Url.Content(Model.ImageUrl))" alt="@Model.Ad" style="max-width:160px; max-height:120px; border-radius:8px; border:1px solid #e6e6e6;" />
            }
            else
            {
                <div class="text-muted">Henüz görsel yüklenmemiş.</div>
            }
        </div>
    </div>

    <div class="form-group mb-3">
        <label for="ImageFile" class="form-label">Yeni Görsel Yükle (opsiyonel)</label>
        <input type="file" name="ImageFile" id="ImageFile" class="form-control" accept=".jpg,.jpeg,.png" />
        <small class="text-muted">Desteklenen formatlar: JPG, PNG. Maksimum 2MB.</small>
        <span class="text-danger" asp-validation-for="ImageUrl"></span>
    </div>

    <div class="mt-3">
        <button type="submit" class="btn btn-primary">Güncelle</button>
        <a asp-action="Index" class="btn btn-secondary ms-2">İptal</a>
    </div>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // İsteğe bağlı: yüklenen görselin ön izlemesini gösterir
        (function () {
            const input = document.getElementById('ImageFile');
            if (!input) return;
            input.addEventListener('change', function (e) {
                const file = e.target.files && e.target.files[0];
                if (!file) return;
                const allowed = ['image/jpeg', 'image/png'];
                if (!allowed.includes(file.type)) {
                    alert('Sadece JPG/PNG formatı desteklenir.');
                    input.value = '';
                    return;
                }
                if (file.size > 2 * 1024 * 1024) {
                    alert('Dosya boyutu maksimum 2 MB olabilir.');
                    input.value = '';
                    return;
                }

                const reader = new FileReader();
                reader.onload = function (ev) {
                    // Mevcut görselin altına veya yerine önizleme ekle
                    let img = document.getElementById('__previewImage');
                    if (!img) {
                        img = document.createElement('img');
                        img.id = '__previewImage';
                        img.style.maxWidth = '160px';
                        img.style.maxHeight = '120px';
                        img.style.borderRadius = '8px';
                        img.style.border = '1px solid #e6e6e6';
                        const container = input.parentElement;
                        container.insertBefore(img, container.children[0]);
                    }
                    img.src = ev.target.result;
                };
                reader.readAsDataURL(file);
            });
        })();
    </script>
}
